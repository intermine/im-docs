(window.webpackJsonp=window.webpackJsonp||[]).push([[433],{504:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return l})),a.d(t,"toc",(function(){return b})),a.d(t,"default",(function(){return c}));var n=a(3),r=a(7),i=(a(0),a(547)),o={title:"Features"},l={unversionedId:"webapp/properties/web-properties",id:"version-4.0.0/webapp/properties/web-properties",isDocsHomePage:!1,title:"Features",description:"The web.properties file configures several attributes for the InterMine web application.",source:"@site/versioned_docs/version-4.0.0/webapp/properties/web-properties.md",slug:"/webapp/properties/web-properties",permalink:"/im-docs/docs/4.0.0/webapp/properties/web-properties",editUrl:"https://github.com/intermine/im-docs/edit/master/versioned_docs/version-4.0.0/webapp/properties/web-properties.md",version:"4.0.0",sidebar:"version-4.0.0/someSidebar",previous:{title:"Text and messages",permalink:"/im-docs/docs/4.0.0/webapp/properties/model-properties"},next:{title:"Data and Widget Configuration",permalink:"/im-docs/docs/4.0.0/webapp/properties/webconfig-model"}},b=[{value:"Branding",id:"branding",children:[]},{value:"Home page",id:"home-page",children:[]},{value:"Tabs",id:"tabs",children:[]},{value:"List upload examples",id:"list-upload-examples",children:[]},{value:"External links",id:"external-links",children:[]},{value:"Settings for the xrefLink property",id:"settings-for-the-xreflink-property",children:[]},{value:"OpenAuth2 Settings (aka. OpenID Connect)",id:"openauth2-settings-aka-openid-connect",children:[{value:"Registering your Application.",id:"registering-your-application",children:[]},{value:"Enabling Supported Providers",id:"enabling-supported-providers",children:[]},{value:"Configuring OLTU Supported Providers",id:"configuring-oltu-supported-providers",children:[]},{value:"Configuring a Custom Provider",id:"configuring-a-custom-provider",children:[]}]},{value:"Delegated Authentication with JWTs",id:"delegated-authentication-with-jwts",children:[{value:"Create a Key Store [optional]",id:"create-a-key-store-optional",children:[]},{value:"Provide Public Keys in your properties files [optional]",id:"provide-public-keys-in-your-properties-files-optional",children:[]},{value:"Selecting keys at runtime.",id:"selecting-keys-at-runtime",children:[]},{value:"Managing non-standard claims",id:"managing-non-standard-claims",children:[]},{value:"Other properties",id:"other-properties",children:[]},{value:"Checking your configuration",id:"checking-your-configuration",children:[]},{value:"Setting up the Key-Store",id:"setting-up-the-key-store",children:[]}]},{value:"Overriding properties",id:"overriding-properties",children:[]}],p={toc:b};function c(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},p,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"web.properties")," file configures several attributes for the InterMine web application."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"attributeLink")),Object(i.b)("p",null,"Used to configure hyperlinks, generally to external dbs. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/webapp/properties/web-properties#external-links"}),"External Links")," below"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"bag.example.identifiers")),Object(i.b)("p",null,"Text present in the list upload form. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/webapp/properties/web-properties#list-upload-examples"}),"List upload examples")," below"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"externallink")),Object(i.b)("p",null,"Redirects links in query results. See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/webapp/query-results/redirects"}),"Link redirects ")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"galaxy")),Object(i.b)("p",null,"See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/webapp/third-party-tools/galaxy"}),"Galaxy")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"genomicRegionSearch")),Object(i.b)("p",null,"See ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/webapp/region-search/index"}),"Region Search")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"header.links")),Object(i.b)("p",null,"Links at upper right corner"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"meta.keywords")),Object(i.b)("p",null,"Will populate meta tag for keywords"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"meta.description")),Object(i.b)("p",null,"Will populate meta tag for description. Google uses this in their search results, I think"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"project.citation")),Object(i.b)("p",null,'Populates the "Cite" text in the footer.'),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"portal.welcome")),Object(i.b)("p",null,"The message to show when a user arrives at the webapp via the portal action ","(","eg. ","<","something",">","/portal.do",")"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"quickSearch.identifiers")),Object(i.b)("p",null,"Text displayed in search box"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"theme")),Object(i.b)("p",null,"Colour scheme for the webapp. Available options are blue, bright","_","blue, gold, green, grey, brown, ecoli","_","blue, metabolic, modmine, ratmine and purple"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"xrefLink")),Object(i.b)("p",null,"Used to configure hyperlinks for CrossReferences. See below"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"markup.webpages.enable")),Object(i.b)("p",null,"Used to enable structured data in JSON-LD format in InterMine web pages. Available options are true or false"),Object(i.b)("h2",{id:"branding"},"Branding"),Object(i.b)("p",null,"These parameters are returned by the branding API end point, and are used by external applications, e.g. the InterMine iOS app, the InterMine registry and the InterMine R client."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"branding.images.logo"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"This image should be 45px by 45px")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"branding.colors.header.main"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Main colour for your mine, defaults to grey, ","#","595455")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"branding.colors.header.text"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text colour for your mine, defaults to white, ","#","fff")))),Object(i.b)("h2",{id:"home-page"},"Home page"),Object(i.b)("p",null,"Search box ","(","first box on the left",")"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.searchBox.title"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"title of box on left")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.searchBox.description"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"text in the box on the left")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.searchBox.example"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"text in the form field")))),Object(i.b)("p",null,"List upload box ","(","middle box",")"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.listBox.title"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Title of box")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.listBox.description"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text in box")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"bag.example.identifiers"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text in form field")))),Object(i.b)("p",null,"Third box"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.thirdBox.title"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Title of box if user is new")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.thirdBox.visitedTitle"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Title of box if user has visited before")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.thirdBox.description"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text in box")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.thirdBox.linkTitle"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text for large button")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.thirdBox.link"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"URL for large button")))),Object(i.b)("h2",{id:"tabs"},"Tabs"),Object(i.b)("p",null,"Templates tagged with each category will appear under the appropriate tab."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.tabs.1.id"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Name of category, eg. Genes")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"begin.tabs.1.description"),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Text for that tab")))),Object(i.b)("h2",{id:"list-upload-examples"},"List upload examples"),Object(i.b)("p",null,"Using the ",Object(i.b)("inlineCode",{parentName:"p"},"bag.example.identifiers")," key, one can provide a list of keyword examples on the list create/upload page. This could lead to a mixed list of items being updated and only, say Protein or Gene, identifiers being uploaded."),Object(i.b)("h2",{id:"external-links"},"External links"),Object(i.b)("p",null,"You can add links to other websites by adding entries to the ",Object(i.b)("inlineCode",{parentName:"p"},"web.properties")," file."),Object(i.b)("p",null,"The format for this property is:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# on the report page - a single identifier\n'attributelink' + unique_name + class + taxonId + attributeName + (url|imageName|text)\n\n# on the list analysis page - a list of identifiers\n'attributelink' + unique_name + class + taxonId + attributeName + 'list' + (url|imageName|text)\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"unique","_","name")),Object(i.b)("p",null,"Used to distinguish between multiple configurations for the same attribute/organism/class combination"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"class")),Object(i.b)("p",null,"Class of object to link, eg. Protein"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"taxonId")),Object(i.b)("p",null,"Either a proper id or '","*","' when no assumption is made regarding the organism"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"attributeName")),Object(i.b)("p",null,"Which identifier field to pass to the URL, e.g. if attributeName is primaryIdentifier, the value of primary identifier field will be used as the attribute value"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"list")),Object(i.b)("p",null,"Indicates the link will have a list of identifiers"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"url")),Object(i.b)("p",null,"URL to link to"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"imageName")),Object(i.b)("p",null,"Name of logo ","(","optional",")",", must be in /model directory"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"text")),Object(i.b)("p",null,"Text that will appear next to the logo"),Object(i.b)("p",null,"The value of the attribute ","(","for the current object",")",' is substituted anywhere the string "',"<","<","attributeValue",">",">",'" occurs in the text or the URL'),Object(i.b)("p",null,"For example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"attributelink.flybase.Gene.7227.primaryIdentifier.url=http://www.flybase.org/.bin/fbidq.html?<<attributeValue>>\nattributelink.flybase.Gene.7227.primaryIdentifier.text=FlyBase: <<attributeValue>>\n")),Object(i.b)("p",null,"In this case ",Object(i.b)("inlineCode",{parentName:"p"},"Gene")," pages for Drosophila melanogaster will have a link that uses the ",Object(i.b)("inlineCode",{parentName:"p"},"organismDbId")," field."),Object(i.b)("p",null,"A list example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"attributelink.flymine.Gene.*.primaryIdentifier.list.url=http://www.flymine.org/flymine/portal.do?externalid=<<attributeValue>>&class=Gene\nattributelink.flymine.Gene.*.primaryIdentifier.list.text=FlyMine\nattributelink.flymine.Gene.*.primaryIdentifier.list.imageName=flymine_logo_link.gif\nattributelink.flymine.Gene.*.primaryIdentifier.list.usePost=true\n")),Object(i.b)("p",null,"Only if a taxonId is specified, the code will check if the link to the external db is relevant."),Object(i.b)("h2",{id:"settings-for-the-xreflink-property"},"Settings for the xrefLink property"),Object(i.b)("p",null,"You can configure the URLs for querying CrossReference from external sources by adding entries to the ",Object(i.b)("inlineCode",{parentName:"p"},"web.properties")," file."),Object(i.b)("p",null,"The format for this property is:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# on the report page\n'xreflink' + dataSource_name + (url|imageName)\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"dataSource","_","name")),Object(i.b)("p",null,"The name of the external database"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"url")),Object(i.b)("p",null,"URL to link to"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"imageName")),Object(i.b)("p",null,"Name of logo ","(","optional",")",", must be in /model directory"),Object(i.b)("p",null,"For example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"xreflink.PFAM.url=http://pfam.sanger.ac.uk/family?\nxreflink.PIRSF.url=http://pir.georgetown.edu/cgi-bin/ipcSF?id=\n")),Object(i.b)("p",null,"Cross references represent identifiers used in external databases, eg. FlyBase, UniProt. An object in InterMine which has CrossReference will have an identifier and data source for that cross reference. In order to find the cross reference in that data source, a URL is required to link to, and the full path should look like url+identifier, e.g. ''",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"http://pfam.sanger.ac.uk/family?PF00001"}),"http://pfam.sanger.ac.uk/family?PF00001"),"''. In web.properties, the first part of the full path could be configured as in \"url\", and identifier will be added programmatically to the rear of it. The dataSource","_","name should be consistent with the source name of the CrossReferences in the InterMine database."),Object(i.b)("h2",{id:"openauth2-settings-aka-openid-connect"},"OpenAuth2 Settings ","(","aka. OpenID Connect",")"),Object(i.b)("p",null,"You can configure your mine to accept delegated authentication from one or more identity resources which are protected by ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"http://oauth.net/2/"}),"OAuth2")," authentication. This involves sending the user to another site, having them sign in there, and being sent back to your InterMine with their credentials."),Object(i.b)("p",null,"We are using the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://attic.apache.org/projects/oltu.html"}),"Apache OLTU")," library to help manage the authentication flow. This means that configuring some of the more common providers, such as Google, Facebook, Github and Microsoft is very simple. It also allows us to add any identity provider that meets certain minimum sanity requirements."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Warning"),"\nGoogle has closed down their OpenID-2 based authentication solution in favour of OpenID Connect ","(","OAuth2",")",". If you want to use Google as an authentication provider you must use OAuth2."),Object(i.b)("p",null,"Configuration is managed through adding values to the ",Object(i.b)("inlineCode",{parentName:"p"},"web-properties"),"."),Object(i.b)("h3",{id:"registering-your-application"},"Registering your Application."),Object(i.b)("p",null,"You ",Object(i.b)("em",{parentName:"p"},"must register your application")," with the provider, giving them details of your application such as its name, and where it will be located. This varies from provider to provider - see ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"http://benfoster.io/blog/oauth-providers"}),"this tutorial")," for a good guide to the registration process for a number of popular providers. For example, for Google, you will need a Google+ account and to visit ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://console.developers.google.com/"}),"the Google developer's console")," to create an application."),Object(i.b)("p",null,"For ELIXIR, you will need:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"an ELIXIR identity. Please register the ELIXIR ID ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://elixir-europe.org/register"}),"here")," , if you don't already"),Object(i.b)("p",{parentName:"li"},"have it")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"register the new client ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://login.elixir-czech.org/oidc/manage/dev/dynreg"}),"here"),", using the ",Object(i.b)("em",{parentName:"p"},"Self-service client registration")," page.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"send an email to ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"mailto:aai-contact@elixir-europe.org"}),"aai-contact@elixir-europe.org")," in order to receive a form that you have to complete with additional information"))),Object(i.b)("p",null,"For each application you will need to register the callback URI, which looks like:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"${webapp.baseurl}/${webapp.path}/oauth2callback.do?provider=${PROVIDER}\n")),Object(i.b)("p",null,"Where ",Object(i.b)("inlineCode",{parentName:"p"},"webapp.baseurl")," and ",Object(i.b)("inlineCode",{parentName:"p"},"webapp.path")," are the corresponding values from your configuration, and ",Object(i.b)("inlineCode",{parentName:"p"},"PROVIDER")," is the name of the provider in all uppercase letters ","(","as configured below",")",". Google requires the ",Object(i.b)("inlineCode",{parentName:"p"},"provider")," parameter as part of the URI, but other providers do not - you should check with each of them."),Object(i.b)("p",null,"You will probably be asked to register a JavaScript domain. This is not used by us, but you can enter the ",Object(i.b)("inlineCode",{parentName:"p"},"webapp.baseurl"),"."),Object(i.b)("h3",{id:"enabling-supported-providers"},"Enabling Supported Providers"),Object(i.b)("p",null,"You will need to inform the InterMine system of the names of the providers which have been configured to work with your application. This should be a comma separated list of provider names. The values are case insensitive, and will be processed as upper-case values. E.g.:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# in  ~/.intermine/MINE.properties\n# You can list just a single provider:\noauth2.providers = GOOGLE\n# or multiple providers, combining standard and custom providers:\noauth2.providers = GOOGLE,ELIXIR,GITHUB,FACEBOOK,MICROSOFT,STRAVA,AIP\n")),Object(i.b)("h3",{id:"configuring-oltu-supported-providers"},"Configuring OLTU Supported Providers"),Object(i.b)("p",null,"To configure an OLTU supported provider ","(","such as Github or Facebook",")",", you simply need to define the client-id and client-secret you registered your application with, eg:"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Warning"),"\nAll secrets, including these ones ","(","especially the client-secret",")"," MUST not be committed to version control or made publicly accessible. DO NOT add them to your web.properties file, but instead, add them to your mine.properties file ","(","eg. ~/.intermine/MINE.properties",")","."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# ~/.intermine/MINE.properties\noauth2.GITHUB.client-id = $GH-CLIENT-ID\noauth2.GITHUB.client-secret = $GH-CLIENT-SECRET\n")),Object(i.b)("h3",{id:"configuring-a-custom-provider"},"Configuring a Custom Provider"),Object(i.b)("p",null,"To configure a custom provider, some other properties need to be provided. Taking AIP's araport system as an example, this can be configured thusly:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# All OAuth2 clients need this configution. Do not commit to version control!\noauth2.AIP.client-id = YOUR_CLIENT_ID\noauth2.AIP.client-secret = YOUR_CLIENT_SECRET\n")),Object(i.b)("p",null,"The URLs needed by the flow - contact your provider to find these out:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.url.auth = https://api.araport.org/authorize\noauth2.AIP.url.token = https://api.araport.org/token\n")),Object(i.b)("p",null,"The scopes need to access the identity resource. This should include sufficient levels of permission to access the name and email of the authenticating user."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.scopes = PRODUCTION\n")),Object(i.b)("p",null,'Information about the way the token endpoint functions. If the token endpoint expects parameters to be passed in the query-string use the value "QUERY", and if the endpoint expects the parameters to be passed in the message body provide the value "BODY":'),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.messageformat = BODY\n")),Object(i.b)("p",null,"Information about the way the token endpoint responds. If the token endpoint responds with ",Object(i.b)("inlineCode",{parentName:"p"},"JSON"),', then provide the value "JSON", and if the endpoint responds with url-encoded form-data, then provide the value "FORM"'),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.responsetype = JSON\n")),Object(i.b)("p",null,'Information about the way the identity resource operates. If the resource expects the bearer token to be in the query parameters, provide the value "query", and if the bearer token is expected to be in the ',Object(i.b)("inlineCode",{parentName:"p"},"Authorization"),' header, pass the value "header".'),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.resource-auth-mechanism = header\n")),Object(i.b)("p",null,"The location of the identity resource. This must be a resource that can respond with ",Object(i.b)("inlineCode",{parentName:"p"},"JSON"),". If query parameters are needed they should be included in the URL. An ",Object(i.b)("inlineCode",{parentName:"p"},"Accept")," header will be provided with the value ",Object(i.b)("inlineCode",{parentName:"p"},"application/json"),"."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"oauth2.AIP.identity-resource = https://api.araport.org/profiles/v2/me\n")),Object(i.b)("p",null,"Guides to interpreting the response from the identity resource. These are all optional."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"# Provide a value if the identity is within a message envelope. The value is the\n# key of the envelope.\noauth2.AIP.identity-envelope = result\n# Provide a key to access a unique identifier for the user. Default = id\noauth2.AIP.id-key = uid\n# Provide a key to access the user's email. Default = email\noauth2.AIP.email-key = email\n# Provide a key to access the user's name. May be a composite value (comma separated). Default = name\noauth2.AIP.name-key = first_name,last_name\n")),Object(i.b)("h2",{id:"delegated-authentication-with-jwts"},"Delegated Authentication with JWTs"),Object(i.b)("p",null,"InterMine supports completely automated delegated authentication, whereby a mediator may add a token that authenticates the user according to a chain of trust. This uses public-key cryptography to establish trust, and JWTs to transmit assertions."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note"),"\nAll the configuration in this section can ","(","and should",")"," go in your ",Object(i.b)("inlineCode",{parentName:"p"},"~/.intermine/MINE.properties")," file."),Object(i.b)("p",null,"To enable this feature you need to do a couple of things:"),Object(i.b)("h3",{id:"create-a-key-store-optional"},"Create a Key Store ","[","optional","]"),Object(i.b)("p",null,"InterMine needs access to public keys - this can mean creating a JKS key store ","(",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"http://docs.oracle.com/javase/7/docs/api/java/security/KeyStore.html"}),"http://docs.oracle.com/javase/7/docs/api/java/security/KeyStore.html"),")"," with the certificate used to sign the JWTs - you should store the certificate against the alias with the same name as used in the ",Object(i.b)("inlineCode",{parentName:"p"},"iss")," claim in the JWT. The keystore file should be saved as ",Object(i.b)("inlineCode",{parentName:"p"},"keystore.jks.$release")," in the ",Object(i.b)("inlineCode",{parentName:"p"},"~/.intermine")," directory, or moved as part of your release cycle to ",Object(i.b)("inlineCode",{parentName:"p"},"MINE/resources/webapp/WEB-INF/")," immediately prior to building your webapp."),Object(i.b)("p",null,"If you do this, then you need to provide the following configuration:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"security.keystore.password")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"The password for this keystore.")))),Object(i.b)("p",null,"If your keystore has no password, then you do not need to set that property. See below for a quick guide to creating a valid keystore."),Object(i.b)("h3",{id:"provide-public-keys-in-your-properties-files-optional"},"Provide Public Keys in your properties files ","[","optional","]"),Object(i.b)("p",null,"Instead of ","(","or in addition to",")"," creating a keystore, you can also provide keys in property files. Even though these are public keys, they are best included in your ",Object(i.b)("inlineCode",{parentName:"p"},"~/.intermine/MINE.properties.release")," file, since they will be specific to a particular instance. Internally if you do not provide a keystore, an empty one will be created."),Object(i.b)("p",null,"This is done by listing them as follows:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"security.publickey.$ALIAS")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"$BASE64","_","ENCODED","_","PUBLIC","_","KEY")))),Object(i.b)("p",null,"You can provide multiple keys and they will all be stored in the applications key-store under the given alias. Every key must have an alias, even if there is only one. If there is a problem with the key ","(","it cannot be decoded, it is not valid, etc",")"," it will be skipped by default, unless the following property is set to ",Object(i.b)("inlineCode",{parentName:"p"},"true")," ","(","in which case it will throw an error and prevent your web-application from starting",")",":"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"keystore.strictpublickeydecoding")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"true")," or ",Object(i.b)("inlineCode",{parentName:"th"},"false"))))),Object(i.b)("p",null,"The value ",Object(i.b)("inlineCode",{parentName:"p"},"BASE64_ENCODED_PUBLIC_KEY")," is the base64 encoding of the bytes of public key. Below is a sample program to illustrate how to do this in Java and python respectively:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-java"}),'import java.security.KeyPairGenerator;\nimport java.security.PublicKey;\nimport org.apache.commons.codec.binary.Base64;\n\npublic class EncodeKey {\n\n    public static void main(String... args) throws Exception {\n        PublicKey key = getKey();\n        Base64 encoder = new Base64();\n        KeyPairGenerator keyGen = KeyPairGenerator.getInstance("RSA");\n        System.out.println(encoder.encodeToString(key.getEncoded()));\n    }\n\n    private static PublicKey getKey() {\n        // Generating a random key - provide your own of course.\n        return keyGen.generateKeyPair().getPublic();\n    }\n}\n')),Object(i.b)("p",null,"or"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-python"}),"# using pycrypto https://www.dlitz.net/software/pycrypto/\nfrom Crypto.PublicKey import RSA\nfrom Crypto import Random\n\n# Generate a new random public key.\nrandom = Random.new().read\npair = RSA.generate(1024, random.read)\npublic_key = pair.publickey()\n\nprint(base64.encodestring(public_key.exportKey(format = 'DER')))\n")),Object(i.b)("h3",{id:"selecting-keys-at-runtime"},"Selecting keys at runtime."),Object(i.b)("p",null,"Since this feature relies on public key cryptography, you need to tell the InterMine application which keys to use to verify which JWT tokens. This can be done with the following properties:"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"jwt.verification.strategy")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"NAMED_ALIAS")," ","(","default",")",", ",Object(i.b)("inlineCode",{parentName:"th"},"ANY"),", or ",Object(i.b)("inlineCode",{parentName:"th"},"WHITELIST")," - optional")))),Object(i.b)("p",null,"This property defaults to the most secure option, ",Object(i.b)("inlineCode",{parentName:"p"},"NAMED_ALIAS"),", where only keys associated with the issuer of the token will be used to verify it. This means you will need to link the two. Each token must identify its issuer ","(","with the ",Object(i.b)("inlineCode",{parentName:"p"},"iss")," claim",")",", you can map from that value to a key available to InterMine by providing the alias it is available as in the keystore. If you plan on accepting your own tokens, then you can provide the alias of your private key."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"security.keystore.alias.$iss")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"The alias for the key certificate used to sign the JWT.")))),Object(i.b)("p",null,"If you use the ",Object(i.b)("inlineCode",{parentName:"p"},"WHITELIST")," strategy, then you must provide the list of aliases that can be used to verify JWTs. All of them will be tried until one verifies successfully."),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"th"},"jwt.alias.whitelist")),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"The comma separated list of aliases to use.")))),Object(i.b)("p",null,"If you select the ",Object(i.b)("inlineCode",{parentName:"p"},"ANY")," strategy, no further configuration is needed."),Object(i.b)("p",null,"Multiple issuers can be supported by providing a key for each alias."),Object(i.b)("h3",{id:"managing-non-standard-claims"},"Managing non-standard claims"),Object(i.b)("p",null,"InterMine reads to claims about the end user from the JWT - who it identifies, and their email address. The email claim is non-standard, and needs to be configured. The subject claim can be overridden if the JWT tokens you are receiving have their subject identified in a different claim. To do so provide the following properties ","(","in the following table, ",Object(i.b)("inlineCode",{parentName:"p"},"$iss")," is the value of the ",Object(i.b)("inlineCode",{parentName:"p"},"iss")," claim of the token",")",":"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"jwt.key.email.$iss")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"The name of the claim that provides the email of the subject. Defaults to ",Object(i.b)("inlineCode",{parentName:"td"},"http://wso2.org/claims/emailaddress"))),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"jwt.key.sub.$iss")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"The name of the claim that provides the identity of the subject. This should be unique for each issuer. Not needed if the token provides the ",Object(i.b)("inlineCode",{parentName:"td"},"sub")," claim")))),Object(i.b)("h3",{id:"other-properties"},"Other properties"),Object(i.b)("p",null,"The following properties may also be important"),Object(i.b)("table",null,Object(i.b)("thead",{parentName:"table"},Object(i.b)("tr",{parentName:"thead"},Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})),Object(i.b)("th",Object(n.a)({parentName:"tr"},{align:"left"})))),Object(i.b)("tbody",{parentName:"table"},Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"jwt.publicidentity")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Used as the iss claim on any tokens the application issues itself. Also, if the tokens received include an ",Object(i.b)("inlineCode",{parentName:"td"},"aud")," claim ","(","see ",Object(i.b)("a",Object(n.a)({parentName:"td"},{href:"http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#audDef"}),"aud definition"),")"," then this value must match that value for verification to complete. Defaults to your project title.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"jwt.verifyaudience")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"true")," or ",Object(i.b)("inlineCode",{parentName:"td"},"false")," ","(","default = true",")",". Whether to verify the aud claim.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"security.privatekey.password")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Used to gain access to the private key used by the application for signing its own tokens.")),Object(i.b)("tr",{parentName:"tbody"},Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),Object(i.b)("inlineCode",{parentName:"td"},"security.privatekey.alias")),Object(i.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"Used to retrieve the private key used by the application for signing its own tokens. To provide a private key you must configure a key store.")))),Object(i.b)("h3",{id:"checking-your-configuration"},"Checking your configuration"),Object(i.b)("p",null,"An ant task is provided to make checking this ","(","admittedly rather complex",")"," set-up easier. To make use of it you should configure your keys as for production, acquire a valid JWT representative of one of the ones you expect to encounter in production, enter you webapp directory ","(",Object(i.b)("inlineCode",{parentName:"p"},"$MINE/webapp"),")"," and then call the following ant task:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"ant verify-jwt \\\n    -Drelease=$RELEASE \\ # Needed to read the correct properties file\n    -Dkeystore=$KEYSTORE_LOCATION \\\n    -Djwt=$JWT\n")),Object(i.b)("p",null,"If correctly set up, you should get a message printed to the console telling you who the token identifies."),Object(i.b)("h3",{id:"setting-up-the-key-store"},"Setting up the Key-Store"),Object(i.b)("p",null,"You will need a Java Key Store to use public-key cryptography for security. To get started, you can use the following command to generate a ",Object(i.b)("inlineCode",{parentName:"p"},"keystore.jks")," file with a new public/private key-pair:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"keytool -genkey -alias ALIAS_A -keyalg RSA -keystore keystore.jks -keysize 2048\n")),Object(i.b)("p",null,"The following command will allow you to add a certificate to your key-store:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"keytool -import -trustcacerts -alias ALIAS_B -file B.crt -keystore keystore.jks\n")),Object(i.b)("p",null,"This set-up would allow you to start accepting JWT tokens signed by the owner of ",Object(i.b)("inlineCode",{parentName:"p"},"B.crt"),", which could be configured by making sure they are associated in your property files. So if the owner of ",Object(i.b)("inlineCode",{parentName:"p"},"B.crt")," identified themselves with the ",Object(i.b)("inlineCode",{parentName:"p"},"iss")," ","(","issuer",")"," claim ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"http://b.com"}),Object(i.b)("inlineCode",{parentName:"a"},"http://b.com")),", then you could link the certificate to the claim with the following property:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"security.keystore.alias.http://b.com = ALIAS_B\n")),Object(i.b)("h2",{id:"overriding-properties"},"Overriding properties"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"intermine/webapp/main/resources/webapp/WEB-INF/global.web.properties")," -"),Object(i.b)("p",{parentName:"li"},"used by all mines. Properties set here will be available to everyone, even the test model mine.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"bio/webapp/resources/webapp/WEB-INF/bio.web.properties")," -"),Object(i.b)("p",{parentName:"li"},"used by all bio-mines. Properties set here will be available to all mines that use the bio layer. So, not the test model. Can overwrite properties in the global.web.properties file.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"flymine/webapp/resources/web.properties")," - used by a mine. Properties set here will be available to only that specific mine. Can create mine-specific properties or overwrite properties in the above two files.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("inlineCode",{parentName:"p"},"$HOME/.intermine/flymine.properties")," - used by a mine. Properties set here will be available only to that specific mine, and will override all other properties. Put sensitive values here that should not be committed to version control."))))}c.isMDXComponent=!0},547:function(e,t,a){"use strict";a.d(t,"a",(function(){return s})),a.d(t,"b",(function(){return h}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function b(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=r.a.createContext({}),c=function(e){var t=r.a.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},s=function(e){var t=c(e.components);return r.a.createElement(p.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,p=b(e,["components","mdxType","originalType","parentName"]),s=c(a),u=n,h=s["".concat(o,".").concat(u)]||s[u]||d[u]||i;return a?r.a.createElement(h,l(l({ref:t},p),{},{components:a})):r.a.createElement(h,l({ref:t},p))}));function h(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var b in t)hasOwnProperty.call(t,b)&&(l[b]=t[b]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);