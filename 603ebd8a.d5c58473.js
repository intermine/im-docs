(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{256:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return c})),a.d(t,"metadata",(function(){return b})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return i}));var n=a(3),r=a(7),o=(a(0),a(547)),c={title:"Installing PostgreSQL"},b={unversionedId:"system-requirements/software/postgres/postgres",id:"version-4.0.0/system-requirements/software/postgres/postgres",isDocsHomePage:!1,title:"Installing PostgreSQL",description:"Warning",source:"@site/versioned_docs/version-4.0.0/system-requirements/software/postgres/postgres.md",slug:"/system-requirements/software/postgres/postgres",permalink:"/im-docs/docs/4.0.0/system-requirements/software/postgres/postgres",editUrl:"https://github.com/intermine/im-docs/edit/master/versioned_docs/version-4.0.0/system-requirements/software/postgres/postgres.md",version:"4.0.0",sidebar:"version-4.0.0/someSidebar",previous:{title:"Perl",permalink:"/im-docs/docs/4.0.0/system-requirements/software/perl"},next:{title:"HikariCP and InterMine settings",permalink:"/im-docs/docs/4.0.0/system-requirements/software/postgres/hikari"}},s=[{value:"Configuration file",id:"configuration-file",children:[]},{value:"Required Configurations",id:"required-configurations",children:[{value:"Allow remote connections",id:"allow-remote-connections",children:[]}]},{value:"Recommended Configurations",id:"recommended-configurations",children:[{value:"Character Set Encoding",id:"character-set-encoding",children:[]},{value:"Database Server Configuration",id:"database-server-configuration",children:[]}]}],l={toc:s};function i(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Warning"),"\nWe recommend you install PostgreSQL 9.2 and above. We currently run our ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://travis-ci.org/intermine/intermine"}),"continuous integration tests")," on PostgreSQL 9.2. ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://www.postgresql.org/download"}),"The PostgreSQL downloads page")," has packages ","(","for most systems",")"," that set up everything for you."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Fedora/CentOS")),Object(o.b)("p",null,Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"https://computingforgeeks.com/how-to-install-postgresql-on-fedora/"}),"https://computingforgeeks.com/how-to-install-postgresql-on-fedora/")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Debian/Ubuntu")),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"sudo apt-get install postgresql")),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Mac")),Object(o.b)("p",null,"There are several good options:"),Object(o.b)("blockquote",null,Object(o.b)("ul",{parentName:"blockquote"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"http://postgresapp.com/"}),"Postgres.app")," - Very easy for a development machine, requires zero configuration."),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/codeforamerica/ohana-api/wiki/Installing-PostgreSQL-with-MacPorts-on-OS-X"}),"MacPorts")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"https://gist.github.com/ibraheem4/ce5ccd3e4d7a65589ce84f2a3b7c23a3"}),"Homebrew")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("a",Object(n.a)({parentName:"li"},{href:"http://www.postgresql.org/download/macosx"}),"Manually"))),Object(o.b)("p",{parentName:"blockquote"},"We have had good experiences with Postgres.app and Macports.")),Object(o.b)("p",null,"Some of the recommended settings below may not apply to older versions of PostgreSQL."),Object(o.b)("h2",{id:"configuration-file"},"Configuration file"),Object(o.b)("p",null,"Most of the configurations below are made by updating the file ",Object(o.b)("inlineCode",{parentName:"p"},"postgresql.conf"),", usually located in ",Object(o.b)("inlineCode",{parentName:"p"},"/etc/postgres/version-nr/main"),"."),Object(o.b)("h2",{id:"required-configurations"},"Required Configurations"),Object(o.b)("h3",{id:"allow-remote-connections"},"Allow remote connections"),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"listen","_","addresses"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"\u2018","*","\u2019"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"port"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"5432")))),Object(o.b)("h2",{id:"recommended-configurations"},"Recommended Configurations"),Object(o.b)("p",null,"The system works reasonably well with the default configuration. For better performance, we recommend to make the changes below."),Object(o.b)("h3",{id:"character-set-encoding"},"Character Set Encoding"),Object(o.b)("p",null,"You should only use either ",Object(o.b)("inlineCode",{parentName:"p"},"SQL_ASCII")," or ",Object(o.b)("inlineCode",{parentName:"p"},"UTF-8"),". If performance is an issue, the use of ",Object(o.b)("inlineCode",{parentName:"p"},"SQL_ASCII")," is strongly recommended. ","[","1","]"),Object(o.b)("p",null,"Procedures to change character encoding to ",Object(o.b)("inlineCode",{parentName:"p"},"SQL_ASCII")," in PostgreSQL 9.x:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo -u postgres psql\nupdate pg_database set datallowconn = TRUE where datname = 'template0';\n\\c template0\nupdate pg_database set datistemplate = FALSE where datname = 'template1';\ndrop database template1;\ncreate database template1 with template = template0 encoding = 'SQL_ASCII' LC_COLLATE='C' LC_CTYPE='C';\nupdate pg_database set datistemplate = TRUE where datname = 'template1';\n\\c template1\nupdate pg_database set datallowconn = FALSE where datname = 'template0';\n\\q\nexit\n")),Object(o.b)("p",null,"you can check the expected screenshot here ","[","2","]"," ."),Object(o.b)("h3",{id:"database-server-configuration"},"Database Server Configuration"),Object(o.b)("h4",{id:"kernel-memory-setting"},"Kernel Memory setting"),Object(o.b)("p",null,"Please check your server kernel setting"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'getconf PAGE_SIZE\ngetconf _PHYS_PAGES\n\nsysctl -a | grep -E "shmall|shmmax"\n')),Object(o.b)("p",null,"(","use sudo if necessary",")"),Object(o.b)("p",null,"Set"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"shmall = phys_pages / 2\nshmmax = shmall * pagesize\n")),Object(o.b)("p",null,"by editing the file"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"/etc/sysctl.d/30-postgresql-shm.conf\n")),Object(o.b)("p",null,"and sourcing it"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"sudo sysctl -p /etc/sysctl.d/30-postgresql-shm.conf\n")),Object(o.b)("h4",{id:"postgresql-parameters"},"PostgreSQL parameters"),Object(o.b)("p",null,"For better performance. Read ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://wiki.postgresql.org/wiki/Tuning_Your_PostgreSQL_Server/"}),"Tuning your PostgreSQL Server")," for more information."),Object(o.b)("table",null,Object(o.b)("thead",{parentName:"table"},Object(o.b)("tr",{parentName:"thead"},Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"Parameter"),Object(o.b)("th",Object(n.a)({parentName:"tr"},{align:"left"}),"Suggested value ","(","build",")"))),Object(o.b)("tbody",{parentName:"table"},Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"shared","_","buffers"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"10-25% of RAM")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"temp","_","buffers"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"around 80MB")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"work","_","mem"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"around 500MB but ","<"," 10% of RAM")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"maintenance","_","work","_","mem"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"5% of RAM but ","<"," 20% of RAM")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"default","_","statistics","_","target"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"around 250")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"random","_","page","_","cost"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"around 2.0-2.5")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"effective","_","cache","_","size"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"50% of RAM")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"synchronous","_","commit"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"off")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"geqo","_","threshold"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"14")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"from","_","collapse","_","limit"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"14")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"join","_","collapse","_","limit"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"14")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"max","_","locks","_","per","_","transaction"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"640")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"max","_","pred","_","locks","_","per","_","transaction"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"640")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"checkpoint","_","segments"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"128")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"checkpoint","_","timeout"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"10min")),Object(o.b)("tr",{parentName:"tbody"},Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"checkpoint","_","completion","_","target"),Object(o.b)("td",Object(n.a)({parentName:"tr"},{align:"left"}),"0.9")))),Object(o.b)("p",null,"Note that most of the changes above require starting postgres."),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Note"),"\nDepending on your system configuration ","(","production or development",")",", the type of sources used in the build ","(","files or databases",")"," and the load on your web application, you may need to increase the ",Object(o.b)("strong",{parentName:"p"},"max","_","connections")," parameter ","(","for example to 250",")","."),Object(o.b)("h4",{id:"client-authentication"},"Client Authentication"),Object(o.b)("p",null,"You should also add a line to the pg","_","hba.conf file to allow logging in via password:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"host    all         all         0.0.0.0/0             password\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"[","1","]"," "),Object(o.b)("p",{parentName:"blockquote"},"The InterMine system stores all text in the database in ",Object(o.b)("inlineCode",{parentName:"p"},"UTF-8")," format. If you set PostgreSQL to ",Object(o.b)("inlineCode",{parentName:"p"},"LATIN-9"),", then PostgreSQL will perform some incorrect conversions, and may even give an error. Setting the format to ",Object(o.b)("inlineCode",{parentName:"p"},"UTF-8")," results in PostgreSQL treating the text completely correctly, which is quite a complicated and slow operation in ",Object(o.b)("inlineCode",{parentName:"p"},"UTF-8"),"."),Object(o.b)("p",{parentName:"blockquote"},"If you set PostgreSQL to ",Object(o.b)("inlineCode",{parentName:"p"},"SQL_ASCII"),", then that is a special character set in Postgres, which basically means \u201cdo no conversions\u201d. This is sufficient for almost all operations. All comparisons and index lookups will be done on a byte-by-byte basis, which is much faster than having to deal with Unicode\u2019s complications."),Object(o.b)("p",{parentName:"blockquote"},"Please try to treat InterMine as a black box. The fact that it uses PostgreSQL to store its data should be a detail that should be hidden as much as possible. The InterMine system is written in Java, and therefore handles all text in Unicode."),Object(o.b)("p",{parentName:"blockquote"},"The template1 database is the database used as a template when you run the ",Object(o.b)("inlineCode",{parentName:"p"},"createdb")," command. Update the encoding for template1 to be SQL","_","ASCII, then every database you create from now on will have the correct encoding.")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"[","2","]"),Object(o.b)("pre",{parentName:"blockquote"},Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"postgres=# update pg_database set datallowconn = TRUE where datname = 'template0';\nUPDATE 1\npostgres=# \\c template0\nYou are now connected to database \"template0\" as user \"postgres\".\ntemplate0=# update pg_database set datistemplate = FALSE where datname = 'template1';\nUPDATE 1\ntemplate0=# drop database template1;\nDROP DATABASE\ntemplate0=# create database template1 with template = template0 encoding = 'SQL_ASCII' LC_COLLATE='C'    LC_CTYPE='C';\nCREATE DATABASE\ntemplate0=# update pg_database set datistemplate = TRUE where datname = 'template1';\nUPDATE 1\ntemplate0=# \\c template1\nYou are now connected to database \"template1\" as user \"postgres\".\ntemplate1=# update pg_database set datallowconn = FALSE where datname = 'template0';\nUPDATE 1\n"))),Object(o.b)("p",null,"See also: ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"/im-docs/docs/4.0.0/system-requirements/software/postgres/hikari"}),"HikariCP and InterMine settings")))}i.isMDXComponent=!0},547:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),i=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):b(b({},t),e)),a},p=function(e){var t=i(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=i(a),d=n,u=p["".concat(c,".").concat(d)]||p[d]||m[d]||o;return a?r.a.createElement(u,b(b({ref:t},l),{},{components:a})):r.a.createElement(u,b({ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,c=new Array(o);c[0]=d;var b={};for(var s in t)hasOwnProperty.call(t,s)&&(b[s]=t[s]);b.originalType=e,b.mdxType="string"==typeof e?e:n,c[1]=b;for(var l=2;l<o;l++)c[l]=a[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,a)}d.displayName="MDXCreateElement"}}]);