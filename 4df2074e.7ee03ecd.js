(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{221:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return s})),a.d(t,"metadata",(function(){return c})),a.d(t,"toc",(function(){return i})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(7),o=(a(0),a(547)),s={title:"Tomcat"},c={unversionedId:"system-requirements/software/tomcat",id:"version-5.0.0/system-requirements/software/tomcat",isDocsHomePage:!1,title:"Tomcat",description:"Installation",source:"@site/versioned_docs/version-5.0.0/system-requirements/software/tomcat.md",slug:"/system-requirements/software/tomcat",permalink:"/im-docs/docs/system-requirements/software/tomcat",editUrl:"https://github.com/intermine/im-docs/edit/master/versioned_docs/version-5.0.0/system-requirements/software/tomcat.md",version:"5.0.0",sidebar:"version-5.0.0/someSidebar",previous:{title:"HikariCP and InterMine settings",permalink:"/im-docs/docs/system-requirements/software/postgres/hikari"},next:{title:"Mac Installation Notes",permalink:"/im-docs/docs/system-requirements/software/macs"}},i=[{value:"Installation",id:"installation",children:[]},{value:"After Installation",id:"after-installation",children:[{value:"Users",id:"users",children:[]},{value:"Context",id:"context",children:[]},{value:"Server XML",id:"server-xml",children:[]},{value:"startup.sh",id:"startupsh",children:[]},{value:"Starting Tomcat",id:"starting-tomcat",children:[]},{value:"Stopping Tomcat",id:"stopping-tomcat",children:[]},{value:"Common Errors",id:"common-errors",children:[]}]}],l={toc:i};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(o.b)("wrapper",Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"installation"},"Installation"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Warning"),"\nSeveral people have had problems with Tomcat installations set up by Linux package managers, mainly due to permissions issues. We recommend installing according to these instructions instead."),Object(o.b)("p",null,"The quickest way to get a working Tomcat:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Download the latest stable binary distribution ","(","i.e. ",Object(o.b)("inlineCode",{parentName:"p"},"tar.gz")," ",")","\nfrom the Apache Tomcat site.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Unpack it like so:"))),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"$ tar -zxvf apache-tomcat-x.y.z.tar.gz\n")),Object(o.b)("h2",{id:"after-installation"},"After Installation"),Object(o.b)("h3",{id:"users"},"Users"),Object(o.b)("p",null,"Set up a tomcat user with the 'manager' role by editing ",Object(o.b)("inlineCode",{parentName:"p"},"conf/tomcat-users.xml")," like so:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-markup"}),'<tomcat-users>\n   <role rolename="manager-gui"/>\n   <role rolename="manager-script"/>\n   <user username="manager" password="manager" roles="manager-gui,manager-script"/>\n</tomcat-users>\n')),Object(o.b)("p",null,"You can check this works by accessing the manager interface at ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://localhost:8080/manager/html"}),"http://localhost:8080/manager/html"),"."),Object(o.b)("p",null,"If you used a package manager to get Tomcat, the manager may not be included. Here's the Debian command you need:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"$ apt-get install tomcat7-admin\n")),Object(o.b)("div",{className:"admonition admonition-info alert alert--info"},Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-heading"}),Object(o.b)("h5",{parentName:"div"},Object(o.b)("span",Object(n.a)({parentName:"h5"},{className:"admonition-icon"}),Object(o.b)("svg",Object(n.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(o.b)("path",Object(n.a)({parentName:"svg"},{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})))),"info")),Object(o.b)("div",Object(n.a)({parentName:"div"},{className:"admonition-content"}),Object(o.b)("p",{parentName:"div"},"The following settings are required only if you use the legacy interface"))),Object(o.b)("h3",{id:"context"},"Context"),Object(o.b)("p",null,"Edit context.xml:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-markup"}),'<Context sessionCookiePath="/" useHttpOnly="false" clearReferencesStopTimerThreads="true">\n... \n</Context>\n')),Object(o.b)("h3",{id:"server-xml"},"Server XML"),Object(o.b)("p",null,"You also need to check in your ",Object(o.b)("inlineCode",{parentName:"p"},"server.xml")," file that the correct ",Object(o.b)("inlineCode",{parentName:"p"},"UTF-8")," encoding has been applied to all connectors in use ","(","see ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://wiki.apache.org/tomcat/FAQ/CharacterEncoding"}),"CharacterEncoding"),")",". Make sure that every connector element in use reads as follows:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),'<Connector ... URIEncoding="UTF-8"/>\n      ...\n</Connector>\n')),Object(o.b)("p",null,"Without this, permalinks may break."),Object(o.b)("h3",{id:"startupsh"},"startup.sh"),Object(o.b)("p",null,"Add this property in startup.sh:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),'JAVA_OPTS="$JAVA_OPTS -Dorg.apache.el.parser.SKIP_IDENTIFIER_CHECK=true"\nexport JAVA_OPTS\n')),Object(o.b)("p",null,"Tomcat 7.0 has improved the enforcement of Expression Language rules and by default doesn't allow the use of Java keywords. This flag makes Tomcat 7 more permissive."),Object(o.b)("p",null,"If tomcat is installed as service, add the property org.apache.el.parser.SKIP","_","IDENTIFIER","_","CHECK=true in the /etc/tomcat7/catalina.properties file instead."),Object(o.b)("h3",{id:"starting-tomcat"},"Starting Tomcat"),Object(o.b)("p",null,"If Tomcat isn't already running, start it with this command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"# from tomcat/bin\n$ ./startup.sh\n")),Object(o.b)("p",null,"Visit the Tomcat manager at ",Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://localhost:8080/"}),"http://localhost:8080/"),". The username and password required to access the manager are ",Object(o.b)("inlineCode",{parentName:"p"},"webapp.manager")," and ",Object(o.b)("inlineCode",{parentName:"p"},"webapp.password")," as specified in your Mine properties file."),Object(o.b)("h3",{id:"stopping-tomcat"},"Stopping Tomcat"),Object(o.b)("p",null,"To stop Tomcat, run this command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-bash"}),"# from tomcat/bin\n$ ./shutdown.sh\n")),Object(o.b)("p",null,"You can't drop a database if Tomcat has an open connection to a Postgres database. You have to:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},"Undeploy your webapp"),Object(o.b)("li",{parentName:"ol"},"Restart tomcat"),Object(o.b)("li",{parentName:"ol"},"dropdb")),Object(o.b)("h3",{id:"common-errors"},"Common Errors"),Object(o.b)("h4",{id:"out-of-memory-errors"},"Out of Memory Errors"),Object(o.b)("p",null,"To avoid ",Object(o.b)("inlineCode",{parentName:"p"},"java.lang.OutOfMemory")," errors, specify the JVM heap size in ",Object(o.b)("inlineCode",{parentName:"p"},"$TOMCAT_HOME/bin/tomcat.sh"),". You can specify the size as part of ",Object(o.b)("inlineCode",{parentName:"p"},"TOMCAT_OPTS"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),"'-Xmx256m -Xms128m'\n")),Object(o.b)("h4",{id:"session-errors"},"Session Errors"),Object(o.b)("p",null,'If you get a "Session Error" when you start up your webapp, you may need to update your Tomcat configuration to remove application path in front of sessions\' cookies.'),Object(o.b)("p",null,'You get this error because the home page makes several requests but your session is lost between transactions with a new session started with the first query. For instance, when you go to the beta.flymine.org home page, your cookie path will initially be "/". To display the "most popular" template queries, a query is run on full URL using the path "/beta". The session with the "/" path is discarded and a new session cookie is created with the "/beta" path. ',"(","You can view the values stored in your cookies via your web browser.",")"),Object(o.b)("p",null,"Add these 2 attributes to ",Object(o.b)("inlineCode",{parentName:"p"},"$TOMCAT/conf/context.xml"),":"),Object(o.b)("pre",null,Object(o.b)("code",Object(n.a)({parentName:"pre"},{className:"language-text"}),'sessionCookiePath="/"\nuseHttpOnly="false"\n')),Object(o.b)("p",null,Object(o.b)("a",Object(n.a)({parentName:"p"},{href:"http://tomcat.apache.org/tomcat-7.0-doc/config/context.html"}),"Tomcat 7.0 context documentation")))}p.isMDXComponent=!0},547:function(e,t,a){"use strict";a.d(t,"a",(function(){return b})),a.d(t,"b",(function(){return d}));var n=a(0),r=a.n(n);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):c(c({},t),e)),a},b=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,l=i(e,["components","mdxType","originalType","parentName"]),b=p(a),u=n,d=b["".concat(s,".").concat(u)]||b[u]||m[u]||o;return a?r.a.createElement(d,c(c({ref:t},l),{},{components:a})):r.a.createElement(d,c({ref:t},l))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=u;var c={};for(var i in t)hasOwnProperty.call(t,i)&&(c[i]=t[i]);c.originalType=e,c.mdxType="string"==typeof e?e:n,s[1]=c;for(var l=2;l<o;l++)s[l]=a[l];return r.a.createElement.apply(null,s)}return r.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);